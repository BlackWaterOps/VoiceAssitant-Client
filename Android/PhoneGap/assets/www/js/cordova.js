// Generated by CoffeeScript 1.6.3
(function() {
  var Cordova,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Cordova = (function() {
    function Cordova(options) {
      this.startupFail = __bind(this.startupFail, this);
      this.speechFail = __bind(this.speechFail, this);
      this.speechInitFail = __bind(this.speechInitFail, this);
      this.speechInitOk = __bind(this.speechInitOk, this);
      this.cleanQuery = __bind(this.cleanQuery, this);
      this.speechOk = __bind(this.speechOk, this);
      this.recognizeSpeech = __bind(this.recognizeSpeech, this);
      this.initQuery = __bind(this.initQuery, this);
      this.startupWin = __bind(this.startupWin, this);
      this.refreshiScroll = __bind(this.refreshiScroll, this);
      this.deviceReady = __bind(this.deviceReady, this);
      this.please = Please || new Please();
      document.addEventListener("deviceready", this.deviceReady, false);
    }

    Cordova.prototype.deviceReady = function() {
      window.plugins.tts.startup(this.startupWin, this.startupFail);
      window.plugins.speechrecognizer.init(this.speechInitOk, this.speechInitFail);
    };

    Cordova.prototype.refreshiScroll = function() {
      var _this = this;
      return setTimeout(function() {
        myScroll.refresh();
        if ($('#board').innerHeight() > hite) {
          return myScroll.scrollToElement('#board div:last-child', 250);
        }
      }, 0);
    };

    Cordova.prototype.startupWin = function(result) {
      if (result === TTS.STARTED) {
        console.log('cordova startupWin');
        return $('.control').on('fastClick', '.micbutton', this.initQuery);
      }
    };

    Cordova.prototype.initQuery = function() {
      window.plugins.tts.stop();
      return this.recognizeSpeech();
    };

    Cordova.prototype.recognizeSpeech = function() {
      var language, maxMatches, promptString, requestCode;
      requestCode = 1234;
      maxMatches = 1;
      promptString = "Please say a command";
      language = "en-US";
      return window.plugins.speechrecognizer.startRecognize(this.speechOk, this.speechFail, requestCode, maxMatches, promptString, language);
    };

    Cordova.prototype.speechOk = function(results) {
      var matches, query, respObj;
      if (results) {
        respObj = JSON.parse(result);
        if (respObj) {
          matches = respObj.speechMatches.speechMatch;
          if (matches.length > 0) {
            query = matches[0];
            query = this.cleanQuery(query);
            return this.please.ask(query);
          }
        }
      }
    };

    Cordova.prototype.cleanQuery = function(query) {
      return query.replace('needa', 'need a');
    };

    Cordova.prototype.speechInitOk = function() {
      return console.log('speech recognizer is ready');
    };

    Cordova.prototype.speechInitFail = function(m) {
      return console.log('speech recognizer failed');
    };

    Cordova.prototype.speechFail = function(message) {
      return console.log("speechFail: " + message);
    };

    Cordova.prototype.startupFail = function(result) {
      return console.log("Startup failure: " + result);
    };

    return Cordova;

  })();

  new Cordova();

}).call(this);
