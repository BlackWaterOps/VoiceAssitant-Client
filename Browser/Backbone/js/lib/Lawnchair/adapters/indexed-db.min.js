Lawnchair.adapter("indexed-db",function(){function fail(e,t){console.error("error in indexed-db adapter!",e,t)}var e="lawnchair",t=2,n=function(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB},r=function(){return window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.oIDBTransaction||window.msIDBTransaction},i=function(){return window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.oIDBKeyRange||window.msIDBKeyRange};return{valid:function(){return!!n()},init:function(r,i){this.idb=n();this.waiting=[];var s=this.idb.open(this.name,t),o=this,u=o.fn(o.name,i),a=function(){return u.call(o,o)},f=function(t,n){try{o.db.deleteObjectStore("teststore")}catch(r){}try{o.db.deleteObjectStore(e)}catch(i){}o.store=o.db.createObjectStore(e,{autoIncrement:!0});for(var s=0;s<o.waiting.length;s++)o.waiting[s].call(o);o.waiting=[];a()};s.onupgradeneeded=function(e){f(e.oldVersion,e.newVersion)};s.onsuccess=function(e){o.db=s.result;if(o.db.version!=""+t){var n=o.db.version,r=o.db.setVersion(""+t);r.onsuccess=function(e){f(n,t)};r.onerror=function(e){console.log("Failed to create objectstore "+e);fail(e)}}else{o.store={};for(var i=0;i<o.waiting.length;i++)o.waiting[i].call(o);o.waiting=[];a()}};s.onerror=fail},save:function(t,n){if(!this.store){this.waiting.push(function(){this.save(t,n)});return}var i=this,s=function(e){if(n){t.key=e.target.result;i.lambda(n).call(i,t)}},o=this.db.transaction(e,r().READ_WRITE),u=o.objectStore(e),a=t.key?u.put(t,t.key):u.put(t);a.onsuccess=s;a.onerror=fail;return this},batch:function(e,t){var n=[],r=!1,i=this,s=function(t){n.push(t);r=n.length===e.length},o=setInterval(function(){if(r){t&&i.lambda(t).call(i,n);clearInterval(o)}},200);for(var u=0,a=e.length;u<a;u++)this.save(e[u],s);return this},get:function(t,n){if(!this.store){this.waiting.push(function(){this.get(t,n)});return}var r=this,i=function(e){n&&r.lambda(n).call(r,e.target.result)};if(!this.isArray(t)){var s=this.db.transaction(e).objectStore(e).get(t);s.onsuccess=i;s.onerror=function(e){console.log("Failed to find "+t);fail(e)}}else{var o=[],u=!1,a=t,f=function(e){o.push(e);u=o.length===a.length},l=setInterval(function(){if(u){n&&r.lambda(n).call(r,o);clearInterval(l)}},200);for(var c=0,h=a.length;c<h;c++)this.get(a[c],f)}return this},exists:function(t,n){if(!this.store){this.waiting.push(function(){this.exists(t,n)});return}var r=this,s=this.db.transaction(e).objectStore(e).openCursor(i().only(t));s.onsuccess=function(e){r.lambda(n).call(r,e.target.result!==null)};s.onerror=function(e){console.log("Failed to test for "+t);fail(e)};return this},all:function(t){if(!this.store){this.waiting.push(function(){this.all(t)});return}var n=this.fn(this.name,t)||undefined,r=this,i=this.db.transaction(e).objectStore(e),s=[];i.openCursor().onsuccess=function(e){var t=e.target.result;if(t){s.push(t.value);t["continue"]()}else n&&n.call(r,s)};return this},remove:function(t,n){if(!this.store){this.waiting.push(function(){this.remove(t,n)});return}typeof t=="object"&&(t=t.key);var i=this,s=function(){n&&i.lambda(n).call(i)},o=this.db.transaction(e,r().READ_WRITE).objectStore(e)["delete"](t);o.onsuccess=s;o.onerror=fail;return this},nuke:function(t){if(!this.store){this.waiting.push(function(){this.nuke(t)});return}var n=this,i=t?function(){n.lambda(t).call(n)}:function(){};try{this.db.transaction(e,r().READ_WRITE).objectStore(e).clear().onsuccess=i}catch(s){fail()}return this}}}());